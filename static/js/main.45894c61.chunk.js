(this["webpackJsonpchess-pwa"]=this["webpackJsonpchess-pwa"]||[]).push([[0],{118:function(e,a,t){e.exports={grid:"GamePreviewsList_grid__2dFgV"}},161:function(e,a,t){e.exports=t(216)},166:function(e,a,t){},209:function(e,a){},216:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),l=t(20),o=t.n(l),i=(t(166),t(67)),c=t(56),s=t(9),u=t(221),m=t(223),d=(t(167),t(54)),p=t(118),f=t.n(p),E=t(146),v=function(e){var a=e.initialFen;"startpos"===a&&(a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");var t=new E.Chess(a);return e.moves&&e.moves.split(" ").forEach((function(e){t.move(e,{sloppy:!0})})),t},b=function(e){var a=e.games,t=void 0===a?[]:a;return r.a.createElement("div",{className:f.a.grid},t.map((function(e){var a=v(e).fen();return r.a.createElement(c.b,{to:"/game/".concat(e.id),key:e.id},r.a.createElement("div",{className:f.a.cell},r.a.createElement(d.Board,{position:a,viewOnly:!1,width:240})))})))},h=t(147),w=t.n(h),g=t(148),y=t.n(g)()(w.a);y.sails.url="http://localhost:1337";var C=y,O=function(e){C.socket.on("game",(function(a){e(a)}))},P=t(123),k=t(29),S=t(100),j=t(82),A=Object(S.a)({games:[]},{GET_GAMES:function(e,a){return{games:a.payload}},UPDATE_GAME:function(e,a){var t=a.payload,n=Object(k.a)({},t.previous,{},t.data),r=Object(j.findIndex)(e.games,{id:t.id});return-1!==r?{games:e.games.map((function(e,a){return a===r?n:e}))}:{games:[].concat(Object(P.a)(e.games),[n])}},CREATE_GAME:function(e,a){var t=a.payload;return{games:[].concat(Object(P.a)(e.games),[t.data])}}}),M=function(){var e=Object(n.useReducer)(A,{games:[]}),a=Object(i.a)(e,2),t=a[0],l=a[1];return Object(n.useEffect)((function(){var e=!0;return new Promise((function(e,a){C.socket.get("/api/v1/game/playing",(function(t,n){200===n.statusCode?e(t):a(n)}))})).then((function(a){e&&l({type:"GET_GAMES",payload:a})})),O((function(a){e&&("updated"===a.verb?l({type:"UPDATE_GAME",payload:a}):"created"===a.verb&&l({type:"CREATE_GAME",payload:a}))})),function(){e=!1}}),[]),r.a.createElement(b,{games:t.games})},N=function(){return r.a.createElement(M,null)},G=function(e){var a=e.game,t=e.onMove;if(!a)return null;var n=v(a),l=n.in_check(),o=n.fen(),i="white"===function(e){return"w"===e.turn()?"white":"black"}(n)?d.PieceColor.WHITE:d.PieceColor.BLACK,c=Object(d.getValidMoves)(n);return r.a.createElement(d.Board,{allowMarkers:!0,check:l,clickable:!0,draggable:!0,position:o,turnColor:i,validMoves:c,viewOnly:"started"!==a.status,onMove:t})},L=function(e){var a=e.id,t=Object(n.useState)(null),l=Object(i.a)(t,2),o=l[0],c=l[1];Object(n.useEffect)((function(){var e=!0;return function(e){return new Promise((function(a,t){C.socket.get("/game/".concat(e),(function(e,n){200===n.statusCode?a(e):t(n)}))}))}(a).then((function(a){e&&c(a)})),O((function(t){e&&t.id===a&&"updated"===t.verb&&c(Object(k.a)({},t.previous,{},t.data))})),function(){e=!1}}),[a]);return o?r.a.createElement(G,{game:o,onMove:function(e){c(Object(k.a)({},o,{moves:"".concat(o.moves," ").concat(e.from).concat(e.to).trim()})),function(e,a){return new Promise((function(t,n){C.socket.post("/api/v1/board/game/".concat(e,"/move/").concat(a),{},(function(e,a){200===a.statusCode?t(e):n(a)}))}))}(a,"".concat(e.from).concat(e.to)).then((function(e){c(e)}))}}):null},_=function(){var e=Object(s.f)().id;return r.a.createElement(L,{id:Number(e)})},R=t(225),I=t(222),T=t(99),V=t(224),B=t(220),q=t(30),H=q.a().shape({email:q.c().email("Invalid email").required("Required"),password:q.c().min(6,"Password length must be >= 6").required("Required")}),U=function(e){var a=e.onSubmit;return r.a.createElement(T.a,{initialValues:{email:"",password:""},validationSchema:H,onSubmit:function(e){function a(a,t){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}((function(e,t){if(a)return a(e,t)}))},(function(e){var a=e.errors,t=e.values,n=e.touched,l=e.handleChange,o=e.handleBlur,i=e.handleSubmit,c=e.isSubmitting,s=e.status,m=e.setStatus;return r.a.createElement(V.a,{noValidate:!0,onSubmit:function(e){return i(e)},onChange:function(){return m("")}},!!s&&r.a.createElement(B.a,{variant:"danger"},s),r.a.createElement(V.a.Group,null,r.a.createElement(V.a.Label,null,"Email address"),r.a.createElement(V.a.Control,{type:"email",name:"email",placeholder:"Enter email",onBlur:o,value:t.email,onChange:l,isValid:n.email&&!a.email,isInvalid:n.email&&!!a.email}),r.a.createElement(V.a.Control.Feedback,{type:"invalid"},a.email)),r.a.createElement(V.a.Group,null,r.a.createElement(V.a.Label,null,"Password"),r.a.createElement(V.a.Control,{type:"password",name:"password",placeholder:"Password",onChange:l,onBlur:o,value:t.password,isValid:n.password&&!a.password,isInvalid:n.password&&!!a.password}),r.a.createElement(V.a.Control.Feedback,{type:"invalid"},a.password)),r.a.createElement(u.a,{variant:"primary",type:"submit",disabled:c},"Login"))}))},F=q.a().shape({fullName:q.c().required("Required"),email:q.c().email("Invalid email").required("Required"),password:q.c().min(6,"Password length must be >= 6").required("Required"),confirmPassword:q.c().equals([q.b("password")],"Please repeat the password").required("Required")}),D=function(e){var a=e.onSubmit;return r.a.createElement(T.a,{initialValues:{fullName:"",email:"",password:"",confirmPassword:""},validationSchema:F,onSubmit:function(e){function a(a,t){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}((function(e,t){if(a)return a(e,t)}))},(function(e){var a=e.errors,t=e.values,n=e.touched,l=e.handleChange,o=e.handleBlur,i=e.handleSubmit,c=e.isSubmitting,s=e.status,m=e.setStatus;return r.a.createElement(V.a,{noValidate:!0,onSubmit:function(e){return i(e)},onChange:function(){return m("")}},!!s&&r.a.createElement(B.a,{variant:"danger"},s),r.a.createElement(V.a.Group,null,r.a.createElement(V.a.Label,null,"Full name"),r.a.createElement(V.a.Control,{type:"text",name:"fullName",placeholder:"Enter full name",onBlur:o,value:t.fullName,onChange:l,isValid:n.fullName&&!a.fullName,isInvalid:n.fullName&&!!a.fullName}),r.a.createElement(V.a.Control.Feedback,{type:"invalid"},a.fullName)),r.a.createElement(V.a.Group,null,r.a.createElement(V.a.Label,null,"Email address"),r.a.createElement(V.a.Control,{type:"email",name:"email",placeholder:"Enter email",onBlur:o,value:t.email,onChange:l,isValid:n.email&&!a.email,isInvalid:n.email&&!!a.email}),r.a.createElement(V.a.Control.Feedback,{type:"invalid"},a.email)),r.a.createElement(V.a.Group,null,r.a.createElement(V.a.Label,null,"Password"),r.a.createElement(V.a.Control,{type:"password",name:"password",placeholder:"Password",onChange:l,onBlur:o,value:t.password,isValid:n.password&&!a.password,isInvalid:n.password&&!!a.password}),r.a.createElement(V.a.Control.Feedback,{type:"invalid"},a.password)),r.a.createElement(V.a.Group,null,r.a.createElement(V.a.Label,null,"Confirm Password"),r.a.createElement(V.a.Control,{type:"password",name:"confirmPassword",placeholder:"Password",onChange:l,onBlur:o,value:t.confirmPassword,isValid:n.confirmPassword&&!a.confirmPassword,isInvalid:n.confirmPassword&&!!a.confirmPassword}),r.a.createElement(V.a.Control.Feedback,{type:"invalid"},a.confirmPassword)),r.a.createElement(u.a,{variant:"primary",type:"submit",disabled:c},"Register"))}))},x=r.a.createContext({user:null,dispatch:function(){}}),K=function(){var e=Object(n.useContext)(x),a=r.a.useCallback((function(a,t){return(n=a,new Promise((function(e,a){C.socket.put("/api/v1/entrance/login",{rememberMe:!0,emailAddress:n.email,password:n.password},(function(t,n){200===n.statusCode?e(t):a(n)}))}))).then((function(a){e.dispatch({type:"LOGIN",payload:a})})).catch((function(e){401===e.statusCode?t.setStatus("Incorrect email or password"):t.setStatus("Internal server error")}));var n}),[e]),t=r.a.useCallback((function(a,t){return(n={fullName:a.fullName,email:a.email,password:a.password},new Promise((function(e,a){C.socket.post("/api/v1/entrance/signup",{fullName:n.fullName,emailAddress:n.email,password:n.password,confirmPassword:n.password,agreed:!0},(function(t,n){200===n.statusCode?e(t):a(n)}))}))).then((function(a){e.dispatch({type:"LOGIN",payload:a})})).catch((function(e){409===e.statusCode?t.setStatus("User with provided email already"):t.setStatus("Internal server error")}));var n}),[e]);return r.a.createElement(R.a,{transition:!1},r.a.createElement(I.a,{eventKey:"home",title:"Login"},r.a.createElement(U,{onSubmit:a})),r.a.createElement(I.a,{eventKey:"profile",title:"Register"},r.a.createElement(D,{onSubmit:t})))},W=Object(S.a)({user:null,isAuthModalVisible:!1},{GET_CURRENT_USER:function(e,a){var t=a.payload;return Object(k.a)({},e,{user:t})},LOGOUT:function(e){return Object(k.a)({},e,{user:null})},LOGIN:function(e,a){var t=a.payload;return Object(k.a)({},e,{isAuthModalVisible:!1,user:t})},SHOW_AUTH_MODAL:function(e){return Object(k.a)({},e,{isAuthModalVisible:!0})},HIDE_AUTH_MODAL:function(e){return Object(k.a)({},e,{isAuthModalVisible:!1})}}),J=function(){var e=Object(n.useReducer)(W,{user:null,isAuthModalVisible:!1}),a=Object(i.a)(e,2),t=a[0],l=a[1];Object(n.useEffect)((function(){new Promise((function(e,a){C.socket.get("/api/v1/account/me",(function(t,n){200===n.statusCode?e(t):401===n.statusCode?e(null):a(n)}))})).then((function(e){l({type:"GET_CURRENT_USER",payload:e})}))}),[]);var o=Object(n.useCallback)((function(){l({type:"SHOW_AUTH_MODAL"})}),[]),d=Object(n.useCallback)((function(){l({type:"HIDE_AUTH_MODAL"})}),[]),p=Object(n.useCallback)((function(){new Promise((function(e,a){C.socket.post("/api/v1/account/logout",{},(function(t,n){200===n.statusCode?e():a(n)}))})).then((function(){l({type:"LOGOUT"})}))}),[]);return r.a.createElement(x.Provider,{value:{user:t.user,dispatch:l}},r.a.createElement(c.a,null,t.user?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,"Hi, ",t.user.fullName),r.a.createElement(u.a,{variant:"primary",onClick:p},"Logout")):r.a.createElement(u.a,{variant:"primary",onClick:o},"Login / Register"),r.a.createElement(m.a,{show:t.isAuthModalVisible,onHide:d,animation:!1},r.a.createElement(m.a.Header,{closeButton:!0},r.a.createElement(m.a.Title,null,"Login")),r.a.createElement(m.a.Body,null,r.a.createElement(K,null))),r.a.createElement("div",null,r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(c.b,{to:"/"},"Home")))),r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/game/:id"},r.a.createElement(_,null)),r.a.createElement(s.a,{path:"/"},r.a.createElement(N,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(J,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[161,1,2]]]);
//# sourceMappingURL=main.45894c61.chunk.js.map