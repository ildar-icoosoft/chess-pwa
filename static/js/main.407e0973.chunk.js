(this["webpackJsonpchess-pwa"]=this["webpackJsonpchess-pwa"]||[]).push([[0],{100:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var a=n(11),r=Object(a.b)({name:"gameClock",initialState:{},reducers:{oneSecondPassed:function(){}},extraReducers:{}}),o=r.actions.oneSecondPassed,i=(r.reducer,function(){return function(e){setInterval((function(){e(o())}),1e3)}})},13:function(e,t,n){"use strict";var a=n(7),r=n(40),o=new a.c.Entity("games",{white:r.a,black:r.a});t.a=o},132:function(e,t,n){e.exports={grid:"GamePreviewsList_grid__2iggX"}},137:function(e,t,n){e.exports={selected:"GameMoves_selected__2FXRO"}},16:function(e,t,n){"use strict";var a=n(160),r=n.n(a),o=n(161),i=n.n(o)()(r.a);i.sails.url="http://localhost:1337",t.a=i},177:function(e,t,n){e.exports=n(234)},185:function(e,t,n){},19:function(e,t,n){"use strict";n.d(t,"h",(function(){return c})),n.d(t,"k",(function(){return d})),n.d(t,"j",(function(){return f})),n.d(t,"p",(function(){return b})),n.d(t,"b",(function(){return p})),n.d(t,"o",(function(){return h})),n.d(t,"m",(function(){return j})),n.d(t,"d",(function(){return y})),n.d(t,"f",(function(){return R})),n.d(t,"i",(function(){return G})),n.d(t,"a",(function(){return B})),n.d(t,"n",(function(){return I})),n.d(t,"l",(function(){return P})),n.d(t,"c",(function(){return L})),n.d(t,"e",(function(){return x}));var a=n(11),r=n(7),o=n(16),i=n(13),c={isLoading:!0,error:null,isFlipped:!1,rewindToMoveIndex:null},l=Object(a.b)({name:"singleGame",initialState:{},reducers:{getSingleGameRequest:function(e,t){e[t.payload]=Object.assign({},c,e[t.payload],{isLoading:!0,error:null})},getSingleGameSuccess:function(e,t){e[t.payload.result]=Object.assign({},c,e[t.payload.result],{isLoading:!1,error:null})},getSingleGameError:function(e,t){e[t.payload.itemId]=Object.assign({},c,e[t.payload.itemId],{isLoading:!1,error:t.payload.error})},abortGameRequest:function(e,t){},abortGameSuccess:function(e,t){},abortGameError:function(e,t){},resignGameRequest:function(e,t){},resignGameSuccess:function(e,t){},resignGameError:function(e,t){},offerDrawRequest:function(e,t){},offerDrawSuccess:function(e,t){},offerDrawError:function(e,t){},acceptDrawOfferRequest:function(e,t){},acceptDrawOfferSuccess:function(e,t){},acceptDrawOfferError:function(e,t){},declineDrawOfferRequest:function(e,t){},declineDrawOfferSuccess:function(e,t){},declineDrawOfferError:function(e,t){},flipBoard:function(e,t){e[t.payload].isFlipped=!e[t.payload].isFlipped},rewindToMove:function(e,t){e[t.payload.gameId].rewindToMoveIndex=t.payload.moveIndex}},extraReducers:{}}),u=l.actions,s=u.getSingleGameRequest,d=u.getSingleGameSuccess,m=u.getSingleGameError,f=u.flipBoard,b=u.rewindToMove,v=u.abortGameRequest,p=u.abortGameSuccess,g=u.abortGameError,w=u.resignGameRequest,h=u.resignGameSuccess,E=u.resignGameError,O=u.offerDrawRequest,j=u.offerDrawSuccess,k=u.offerDrawError,C=u.acceptDrawOfferRequest,y=u.acceptDrawOfferSuccess,S=u.acceptDrawOfferError,M=u.declineDrawOfferRequest,R=u.declineDrawOfferSuccess,A=u.declineDrawOfferError;t.g=l.reducer;var G=function(e){return function(t){return t(s(e)),new Promise((function(n,a){o.a.socket.get("/game/".concat(e),(function(o,c){if(200===c.statusCode){var l=Object(r.b)(o,i.a);t(d(l)),n(o)}else t(m({itemId:e,error:o})),a(c)}))}))}},B=function(e){return function(t){return t(v(e)),new Promise((function(n,a){o.a.socket.post("/api/v1/board/game/".concat(e,"/abort"),(function(o,c){if(200===c.statusCode){var l=Object(r.b)(o,i.a);t(p(l)),n(o)}else t(g({itemId:e,error:o})),a(c)}))}))}},I=function(e){return function(t){return t(w(e)),new Promise((function(n,a){o.a.socket.post("/api/v1/board/game/".concat(e,"/resign"),(function(o,c){if(200===c.statusCode){var l=Object(r.b)(o,i.a);t(h(l)),n(o)}else t(E({itemId:e,error:o})),a(c)}))}))}},P=function(e){return function(t){return t(O(e)),new Promise((function(n,a){o.a.socket.post("/api/v1/board/game/".concat(e,"/draw/yes"),(function(o,c){if(200===c.statusCode){var l=Object(r.b)(o,i.a);t(j(l)),n(o)}else t(k({itemId:e,error:o})),a(c)}))}))}},L=function(e){return function(t){return t(C(e)),new Promise((function(n,a){o.a.socket.post("/api/v1/board/game/".concat(e,"/draw/yes"),(function(o,c){if(200===c.statusCode){var l=Object(r.b)(o,i.a);t(y(l)),n(o)}else t(S({itemId:e,error:o})),a(c)}))}))}},x=function(e){return function(t){return t(M(e)),new Promise((function(n,a){o.a.socket.post("/api/v1/board/game/".concat(e,"/draw/no"),(function(o,c){if(200===c.statusCode){var l=Object(r.b)(o,i.a);t(R(l)),n(o)}else t(A({itemId:e,error:o})),a(c)}))}))}}},21:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return m})),n.d(t,"h",(function(){return f})),n.d(t,"b",(function(){return v})),n.d(t,"d",(function(){return p})),n.d(t,"g",(function(){return g})),n.d(t,"f",(function(){return w}));var a=n(11),r=n(7),o=n(16),i=n(40),c=Object(a.b)({name:"currentUser",initialState:{userId:null,isLoading:!0,error:null},reducers:{getCurrentUserRequest:function(e){e.isLoading=!0,e.error=null},getCurrentUserSuccess:function(e,t){e.userId=t.payload?t.payload.result:null,e.isLoading=!1,e.error=null},getCurrentUserError:function(e,t){e.isLoading=!1,e.error=t.payload},loginSuccess:function(e,t){e.userId=t.payload.result},registerSuccess:function(e,t){e.userId=t.payload.result},logoutSuccess:function(e){e.userId=null}}}),l=c.actions,u=l.getCurrentUserRequest,s=l.getCurrentUserSuccess,d=l.getCurrentUserError,m=l.loginSuccess,f=l.registerSuccess,b=l.logoutSuccess;t.a=c.reducer;var v=function(){return function(e){return e(u()),new Promise((function(t,n){o.a.socket.get("/api/v1/account/me",(function(a,o){if(200===o.statusCode){var c=Object(r.b)(a,i.a);e(s(c)),t(a)}else 401===o.statusCode?(e(s(null)),t(null)):(e(d(a)),n(o))}))}))}},p=function(e){return function(t){return new Promise((function(n,a){o.a.socket.put("/api/v1/entrance/login",{emailAddress:e.email,password:e.password},(function(e,o){if(200===o.statusCode){var c=Object(r.b)(e,i.a);t(m(c)),n(e)}else a(o)}))}))}},g=function(e){return function(t){return new Promise((function(n,a){o.a.socket.post("/api/v1/entrance/signup",{fullName:e.fullName,emailAddress:e.email,password:e.password,confirmPassword:e.password,agreed:!0},(function(e,o){if(200===o.statusCode){var c=Object(r.b)(e,i.a);t(f(c)),n(e)}else a(o)}))}))}},w=function(){return function(e){return new Promise((function(t,n){o.a.socket.post("/api/v1/account/logout",{},(function(a,r){200===r.statusCode?(e(b()),t()):n(r)}))}))}}},214:function(e,t){},231:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(50),i=n(14),c=n(9),l=(n(218),n(7)),u=n(26),s=n(132),d=n.n(s),m=n(36),f=function(e){var t=e.games,n=void 0===t?[]:t;return r.a.createElement("div",{className:d.a.grid},n.map((function(e){var t=Object(m.a)(e).fen();return r.a.createElement(o.b,{to:"/game/".concat(e.id),key:e.id},r.a.createElement("div",{className:d.a.cell},r.a.createElement(u.Board,{position:t,viewOnly:!1,width:240})))})))},b=n(13),v=function(){var e=Object(c.c)((function(e){return Object(l.a)(Object.keys(e.entities.games),[b.a],e.entities).filter((function(e){return"started"===e.status})).sort((function(e,t){return t.createdAt-e.createdAt}))}));return r.a.createElement(f,{games:e})},p=n(236),g=function(e){var t=e.onChallengeAi,n=Object(a.useCallback)((function(){t&&t()}),[t]);return r.a.createElement(p.a,{variant:"primary",onClick:n,"data-testid":"challenge-ai-btn"},"Play with the computer")},w=n(70),h=function(){var e=Object(c.b)(),t=Object(a.useCallback)((function(){e(Object(w.c)())}),[e]);return r.a.createElement(g,{onChallengeAi:t})},E=n(241),O=n(82),j=n(4),k=n.n(j),C=n(242),y=n(237),S=n(238),M=n(239),R=n(48),A=n.n(R),G=function(e){var t=e.onSubmit;return r.a.createElement(O.a,{initialValues:{level:3,color:"",clockLimit:300,clockIncrement:3},onSubmit:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,n){if(t)return t(e,n)}))},(function(e){var t=e.values,n=e.handleChange,a=e.handleBlur,o=e.handleSubmit,i=e.isSubmitting,c=e.status,l=e.setStatus,u=e.setFieldValue;return r.a.createElement(C.a,{noValidate:!0,onSubmit:function(e){return o(e)},onChange:function(){return l("")}},!!c&&r.a.createElement(y.a,{variant:"danger"},c),r.a.createElement("fieldset",null,r.a.createElement(C.a.Group,null,r.a.createElement(C.a.Label,null,"Minutes per side: ",t.clockLimit/60),r.a.createElement(C.a.Control,{type:"range",name:"clockLimit",onBlur:a,value:t.clockLimit,onChange:n,min:"60",max:"1800",step:"60"})),r.a.createElement(C.a.Group,null,r.a.createElement(C.a.Label,null,"Increment in seconds: ",t.clockIncrement),r.a.createElement(C.a.Control,{type:"range",name:"clockIncrement",onBlur:a,value:t.clockIncrement,onChange:n,min:"0",max:"60"}))),r.a.createElement("div",{className:"text-center"},"Level"),r.a.createElement(S.a,null,r.a.createElement(M.a,{className:k()("mx-auto",A.a.levelButtonGroup)},[1,2,3,4].map((function(e){return r.a.createElement(p.a,{key:e,type:"button",variant:e===t.level?"dark":"light",onClick:function(){return u("level",e)}},e)})))),r.a.createElement("div",{className:"text-center"},"A.I. Level: ",t.level),r.a.createElement("div",{className:A.a.colorSubmits},r.a.createElement("button",{disabled:i,type:"submit",title:"Black",className:k()(A.a.colorSubmitsButton,A.a.blackButton),onClick:function(){return u("color","black")}},r.a.createElement("i",null)),r.a.createElement("button",{disabled:i,type:"submit",title:"Random side",className:k()(A.a.colorSubmitsButton,A.a.randomButton),onClick:function(){return u("color","random")}},r.a.createElement("i",null)),r.a.createElement("button",{disabled:i,type:"submit",title:"White",className:k()(A.a.colorSubmitsButton,A.a.whiteButton),onClick:function(){return u("color","white")}},r.a.createElement("i",null))))}))},B=n(71),I=function(){var e=Object(c.b)(),t=Object(i.f)(),n=Object(a.useCallback)((function(n,a){return e(Object(B.a)(n)).then((function(e){t.push("/game/".concat(e.id))})).catch((function(e){401===e.statusCode?a.setStatus("You must log in to play with computer"):a.setStatus("Internal server error")}))}),[e,t]);return r.a.createElement(G,{onSubmit:n})},P=function(e){var t=e.show,n=void 0!==t&&t,a=e.onHide;return r.a.createElement(E.a,{show:n,onHide:a,animation:!1},r.a.createElement(E.a.Header,{closeButton:!0},r.a.createElement(E.a.Title,null,"Play with the computer")),r.a.createElement(E.a.Body,null,r.a.createElement(I,null)))},L=function(){var e=Object(c.c)((function(e){return e.challengeAiModal})).isChallengeAiModalVisible,t=Object(c.b)(),n=Object(a.useCallback)((function(){t(Object(w.b)())}),[t]);return r.a.createElement(P,{show:e,onHide:n})},x=function(){var e=Object(c.c)((function(e){return Object(l.a)(Object.keys(e.entities.games),[b.a],e.entities).filter((function(e){return"started"!==e.status&&"aborted"!==e.status})).sort((function(e,t){return t.createdAt-e.createdAt}))}));return r.a.createElement(f,{games:e})},N=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(L,null),r.a.createElement("div",{className:"d-flex justify-content-center"},r.a.createElement(h,null)),r.a.createElement("h3",null,"Ongoing Games"),r.a.createElement(v,null),r.a.createElement("h3",null,"Completed Games"),r.a.createElement(x,null))},D=function(e){var t=e.game;return t?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,function(e){if("outoftime"===e.status){if("white"===e.winner)return"Time out \u2022 White is victorious";if("black"===e.winner)return"Time out \u2022 Black is victorious"}if("resign"===e.status){if("black"===e.winner)return"White resigned \u2022 Black is victorious";if("white"===e.winner)return"Black resigned \u2022 White is victorious"}if("aborted"===e.status)return"Game aborted";if("mate"===e.status){if("white"===e.winner)return"Checkmate \u2022 White is victorious";if("black"===e.winner)return"Checkmate \u2022 Black is victorious"}return"draw"===e.status?"Draw":"stalemate"===e.status?"Stalemate":"Playing right now"}(t)),r.a.createElement("div",null,t.clockLimit/60," + ",t.clockIncrement),r.a.createElement("div",{"data-testid":"white-user"},"White: ",t.white?t.white.fullName:"AI level ".concat(t.aiLevel)),r.a.createElement("div",{"data-testid":"black-user"},"Black: ",t.black?t.black.fullName:"AI level ".concat(t.aiLevel))):null},T=n(172),F=n.n(T),q=function(e){var t=e.time,n=void 0===t?0:t,a=F()().startOf("day").milliseconds(n).format("mm : ss");return r.a.createElement("div",{"data-testid":"time"},a)},_=n(10),V=n(99),U=n(137),H=n.n(U),W=function(e){return"".concat(e.from).concat(e.to)},K=function(e){var t=e.game,n=e.rewindToMoveIndex,a=void 0===n?null:n,o=e.onRewindToMove;if(!t)return null;var i=Object(m.a)(t).history({verbose:!0}),c=Object(V.chunk)(i,2),l=function(e){return function(){o&&o(e)}};return r.a.createElement("table",null,r.a.createElement("tbody",null,c.map((function(e,t){return r.a.createElement("tr",{key:"move-".concat(t)},r.a.createElement("td",null,t+1),r.a.createElement("td",null,r.a.createElement("div",{"data-testid":"move-".concat(2*t),onClick:l(2*t),role:"button",className:k()(Object(_.a)({},H.a.selected,a===2*t))},W(e[0]))),r.a.createElement("td",null,e[1]&&r.a.createElement("div",{"data-testid":"move-".concat(2*t+1),onClick:l(2*t+1),role:"button",className:k()(Object(_.a)({},H.a.selected,a===2*t+1))},W(e[1]))))}))))},J=function(e){var t=e.game,n=e.color,a=void 0===n?"white":n;return t?r.a.createElement("div",null,t[a]?t[a].fullName:"AI level ".concat(t.aiLevel)):null},Q=function(e){var t=e.isFirstMove,n=void 0!==t&&t,o=e.isLastMove,i=void 0!==o&&o,c=e.hasPrevMove,l=void 0!==c&&c,u=e.hasNextMove,s=void 0!==u&&u,d=e.onFlipBoard,m=e.onRewindToPrevMove,f=e.onRewindToNextMove,b=e.onRewindToFirstMove,v=e.onRewindToLastMove,p=Object(a.useCallback)((function(){d&&d()}),[d]),g=Object(a.useCallback)((function(){m&&m()}),[m]),w=Object(a.useCallback)((function(){f&&f()}),[f]),h=Object(a.useCallback)((function(){b&&b()}),[b]),E=Object(a.useCallback)((function(){v&&v()}),[v]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{type:"button","data-testid":"flip-board-btn",onClick:p},"Flip board"),r.a.createElement("button",{type:"button","data-testid":"rewind-to-prev-move-btn",onClick:g,disabled:!l},"Rewind to prev move"),r.a.createElement("button",{type:"button","data-testid":"rewind-to-first-move-btn",onClick:h,disabled:n},"Rewind to first move"),r.a.createElement("button",{type:"button","data-testid":"rewind-to-last-move-btn",onClick:E,disabled:i},"Rewind to last move"),r.a.createElement("button",{type:"button","data-testid":"rewind-to-next-move-btn",onClick:w,disabled:!s},"Rewind to next move"))},X=function(e){var t=e.canAbortGame,n=void 0!==t&&t,o=e.canOfferDraw,i=void 0!==o&&o,c=e.canResignGame,l=void 0!==c&&c,u=e.onAbortGame,s=e.onOfferDraw,d=e.onResignGame,m=Object(a.useCallback)((function(){u&&u()}),[u]),f=Object(a.useCallback)((function(){s&&s()}),[s]),b=Object(a.useCallback)((function(){d&&d()}),[d]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{type:"button","data-testid":"abort-game-btn",onClick:m,disabled:!n},"Abort"),r.a.createElement("button",{type:"button","data-testid":"offer-draw-btn",onClick:f,disabled:!i},"Offer a draw"),r.a.createElement("button",{type:"button","data-testid":"resign-game-btn",onClick:b,disabled:!l},"Resign"))},Y=function(e){var t=e.onAccept,n=e.onDecline,o=Object(a.useCallback)((function(){t&&t()}),[t]),i=Object(a.useCallback)((function(){n&&n()}),[n]);return r.a.createElement("div",null,r.a.createElement("button",{type:"button","data-testid":"accept-btn",onClick:o},"Accept"),r.a.createElement("button",{type:"button","data-testid":"decline-btn",onClick:i},"Decline"))},$=function(e){var t=e.game,n=e.orientation,a=void 0===n?"white":n,o=e.rewindToMoveIndex,i=void 0===o?null:o,c=e.canAbortGame,l=void 0!==c&&c,u=e.canOfferDraw,s=void 0!==u&&u,d=e.canResignGame,f=void 0!==d&&d,b=e.drawOfferSentByCurrentUser,v=void 0!==b&&b,p=e.drawOfferSentByOpponent,g=void 0!==p&&p,w=e.onAcceptDrawOffer,h=e.onDeclineDrawOffer,E=e.onRewindToMove,O=e.onFlipBoard,j=e.onRewindToPrevMove,k=e.onRewindToNextMove,C=e.onRewindToFirstMove,y=e.onRewindToLastMove,S=e.onAbortGame,M=e.onOfferDraw,R=e.onResignGame;if(!t)return null;var A=Object(m.a)(t).history(),G=A.length<=1||0===i,B=null===i,I=A.length>1&&0!==i,P=null!==i;return r.a.createElement("div",null,r.a.createElement(q,{time:"white"===a?t.btime:t.wtime}),r.a.createElement(J,{game:t,color:"white"===a?"black":"white"}),r.a.createElement(Q,{isFirstMove:G,isLastMove:B,hasPrevMove:I,hasNextMove:P,onFlipBoard:O,onRewindToPrevMove:j,onRewindToNextMove:k,onRewindToFirstMove:C,onRewindToLastMove:y}),r.a.createElement(K,{game:t,rewindToMoveIndex:i,onRewindToMove:E}),g&&r.a.createElement(Y,{onAccept:w,onDecline:h}),v&&r.a.createElement("div",{"data-testid":"draw-offer-sent-message"},"Draw offer sent"),r.a.createElement(X,{canAbortGame:l,canOfferDraw:s,canResignGame:f,onAbortGame:S,onOfferDraw:M,onResignGame:R}),r.a.createElement(J,{game:t,color:"white"===a?"white":"black"}),r.a.createElement(q,{time:"white"===a?t.wtime:t.btime}))},z=function(e){var t,n,a,o,i,c,l,s,d,f,b,v,p,g,w,h=e.game,E=e.currentUser,O=e.isFlipped,j=void 0!==O&&O,k=e.rewindToMoveIndex,C=void 0===k?null:k,y=e.onAcceptDrawOffer,S=e.onDeclineDrawOffer,M=e.onAbortGame,R=e.onOfferDraw,A=e.onResignGame,G=e.onMove,B=e.onFlipBoard,I=e.onRewindToMove;if(!h)return null;var P,L=Object(m.a)(h),x=null===C?L:Object(m.a)(h,C),N=x.in_check(),T=x.fen(),F="white"===h.turn?u.PieceColor.WHITE:u.PieceColor.BLACK,q=Object(u.getValidMoves)(x),_=!0;!E||E.id!==(null===(t=h.white)||void 0===t?void 0:t.id)&&E.id!==(null===(n=h.black)||void 0===n?void 0:n.id)||"started"!==h.status||null!==C||(_=!1),E&&E.id===(null===(a=h.white)||void 0===a?void 0:a.id)&&(P=u.PieceColor.WHITE),E&&E.id===(null===(o=h.black)||void 0===o?void 0:o.id)&&(P=u.PieceColor.BLACK);var V=u.PieceColor.WHITE;E&&E.id===(null===(i=h.black)||void 0===i?void 0:i.id)&&(V=u.PieceColor.BLACK),j&&(V=V===u.PieceColor.WHITE?u.PieceColor.BLACK:u.PieceColor.WHITE);var U,H=L.history({verbose:!0});if(null===C){if(H.length){var W=H[H.length-1];U=[W.from,W.to]}}else{var K=H[C];U=[K.from,K.to]}var J=!1;E&&(E.id===(null===(c=h.white)||void 0===c?void 0:c.id)||E.id===(null===(l=h.black)||void 0===l?void 0:l.id))&&"started"===h.status&&H.length<2&&(J=!0);var Q=!1;E&&(E.id===(null===(s=h.white)||void 0===s?void 0:s.id)||E.id===(null===(d=h.black)||void 0===d?void 0:d.id))&&"started"===h.status&&H.length>1&&(Q=!0);var X=!1;E&&(E.id===(null===(f=h.white)||void 0===f?void 0:f.id)||E.id===(null===(b=h.black)||void 0===b?void 0:b.id))&&null===h.drawOffer&&0===h.aiLevel&&"started"===h.status&&H.length>1&&(X=!0);var Y,z,Z=null;E&&(E.id===(null===(Y=h.white)||void 0===Y?void 0:Y.id)?Z="white":E.id===(null===(z=h.black)||void 0===z?void 0:z.id)&&(Z="black"));var ee=!1;!E||E.id!==(null===(v=h.white)||void 0===v?void 0:v.id)&&E.id!==(null===(p=h.black)||void 0===p?void 0:p.id)||"started"!==h.status||h.drawOffer!==Z||(ee=!0);var te=!1;!E||E.id!==(null===(g=h.white)||void 0===g?void 0:g.id)&&E.id!==(null===(w=h.black)||void 0===w?void 0:w.id)||"started"!==h.status||null===h.drawOffer||h.drawOffer===Z||(te=!0);return r.a.createElement(r.a.Fragment,null,r.a.createElement(D,{game:h}),r.a.createElement($,{game:h,orientation:V,rewindToMoveIndex:C,canAbortGame:J,canResignGame:Q,canOfferDraw:X,drawOfferSentByCurrentUser:ee,drawOfferSentByOpponent:te,onAcceptDrawOffer:y,onDeclineDrawOffer:S,onFlipBoard:B,onAbortGame:M,onOfferDraw:R,onResignGame:A,onRewindToMove:function(e){I&&(e===H.length-1?I(null):I(e))},onRewindToFirstMove:function(){I&&I(0)},onRewindToLastMove:function(){I&&I(null)},onRewindToPrevMove:function(){I&&I(null===C?H.length-2:C-1)},onRewindToNextMove:function(){I&&(C===H.length-2?I(null):I(C+1))}}),r.a.createElement(u.Board,{allowMarkers:!0,check:N,clickable:!0,draggable:!0,orientation:V,position:T,turnColor:F,lastMoveSquares:U,movableColor:P,validMoves:q,viewOnly:_,onMove:G}))},Z=n(19),ee=n(89),te=n(40),ne=function(e){var t=e.id,n=Object(c.b)(),o=Object(c.c)((function(e){return Object(l.a)(t,b.a,e.entities)})),i=Object(c.c)((function(e){if(e.currentUser.userId)return Object(l.a)(e.currentUser.userId,te.a,e.entities)})),u=Object(c.c)((function(e){return e.singleGame[t]}))||Z.h;Object(a.useEffect)((function(){n(Object(Z.i)(t))}),[n,t]);var s=Object(a.useCallback)((function(){n(Object(Z.c)(t))}),[n,t]),d=Object(a.useCallback)((function(){n(Object(Z.e)(t))}),[n,t]),m=Object(a.useCallback)((function(){n(Object(Z.a)(t))}),[n,t]),f=Object(a.useCallback)((function(){n(Object(Z.n)(t))}),[n,t]),v=Object(a.useCallback)((function(){n(Object(Z.l)(t))}),[n,t]),p=Object(a.useCallback)((function(e){n(Object(ee.a)(t,"".concat(e.from).concat(e.to)))}),[n,t]),g=Object(a.useCallback)((function(){n(Object(Z.j)(t))}),[n,t]),w=Object(a.useCallback)((function(e){n(Object(Z.p)({moveIndex:e,gameId:t}))}),[n,t]);return o?r.a.createElement(z,{game:o,currentUser:i,rewindToMoveIndex:u.rewindToMoveIndex,onAcceptDrawOffer:s,onDeclineDrawOffer:d,onAbortGame:m,onOfferDraw:v,onResignGame:f,onMove:p,onFlipBoard:g,onRewindToMove:w,isFlipped:u.isFlipped}):null},ae=function(){var e=Object(i.g)().id;return r.a.createElement(ne,{id:Number(e)})},re=n(21),oe=n(88),ie=n(100),ce=function(e){var t=e.currentUser,n=void 0===t?null:t,i=e.onLogout,c=e.onShowAuthModal,l=Object(a.useCallback)((function(){i&&i()}),[i]),u=Object(a.useCallback)((function(){c&&c()}),[c]);return r.a.createElement("header",{className:"d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow"},r.a.createElement("div",{className:"offset-4 col-4 text-center"},r.a.createElement(o.b,{className:"blog-header-logo text-dark",to:"/"},"Chess PWA")),r.a.createElement("div",{className:"col-4 d-flex justify-content-end align-items-center"},n?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mr-3"},"Hi, ",n.fullName),r.a.createElement(p.a,{className:"btn btn-sm btn-danger mr-3","data-testid":"logout-btn",onClick:l},"Logout")):r.a.createElement(p.a,{className:"btn btn-sm btn-success mr-3","data-testid":"login-btn",onClick:u},"Login / Register"),r.a.createElement("a",{href:"https://github.com/ildar-icoosoft/chess-pwa",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:"".concat("/chess-pwa","/imgs/GitHub-Mark-32px.png"),alt:""}))))},le=n(69),ue=function(){var e=Object(c.c)((function(e){return e.currentUser.userId?Object(l.a)(e.currentUser.userId,te.a,e.entities):null})),t=Object(c.b)(),n=Object(a.useCallback)((function(){t(Object(re.f)())}),[t]),o=Object(a.useCallback)((function(){t(Object(le.c)())}),[t]);return r.a.createElement(ce,{currentUser:e,onLogout:n,onShowAuthModal:o})},se=n(243),de=n(240),me=n(41),fe=me.a().shape({email:me.c().email("Invalid email").required("Required"),password:me.c().min(6,"Password length must be >= 6").required("Required")}),be=function(e){var t=e.onSubmit;return r.a.createElement(O.a,{initialValues:{email:"",password:""},validationSchema:fe,onSubmit:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,n){if(t)return t(e,n)}))},(function(e){var t=e.errors,n=e.values,a=e.touched,o=e.handleChange,i=e.handleBlur,c=e.handleSubmit,l=e.isSubmitting,u=e.status,s=e.setStatus;return r.a.createElement(C.a,{noValidate:!0,onSubmit:function(e){return c(e)},onChange:function(){return s("")}},!!u&&r.a.createElement(y.a,{variant:"danger"},u),r.a.createElement(C.a.Group,null,r.a.createElement(C.a.Label,null,"Email address"),r.a.createElement(C.a.Control,{type:"email",name:"email",placeholder:"Enter email",onBlur:i,value:n.email,onChange:o,isValid:a.email&&!t.email,isInvalid:a.email&&!!t.email}),r.a.createElement(C.a.Control.Feedback,{type:"invalid"},t.email)),r.a.createElement(C.a.Group,null,r.a.createElement(C.a.Label,null,"Password"),r.a.createElement(C.a.Control,{type:"password",name:"password",placeholder:"Password",onChange:o,onBlur:i,value:n.password,isValid:a.password&&!t.password,isInvalid:a.password&&!!t.password}),r.a.createElement(C.a.Control.Feedback,{type:"invalid"},t.password)),r.a.createElement(p.a,{variant:"primary",type:"submit",disabled:l},"Login"))}))},ve=me.a().shape({fullName:me.c().required("Required"),email:me.c().email("Invalid email").required("Required"),password:me.c().min(6,"Password length must be >= 6").required("Required"),confirmPassword:me.c().equals([me.b("password")],"Please repeat the password").required("Required")}),pe=function(e){var t=e.onSubmit;return r.a.createElement(O.a,{initialValues:{fullName:"",email:"",password:"",confirmPassword:""},validationSchema:ve,onSubmit:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,n){if(t)return t(e,n)}))},(function(e){var t=e.errors,n=e.values,a=e.touched,o=e.handleChange,i=e.handleBlur,c=e.handleSubmit,l=e.isSubmitting,u=e.status,s=e.setStatus;return r.a.createElement(C.a,{noValidate:!0,onSubmit:function(e){return c(e)},onChange:function(){return s("")}},!!u&&r.a.createElement(y.a,{variant:"danger"},u),r.a.createElement(C.a.Group,null,r.a.createElement(C.a.Label,null,"Full name"),r.a.createElement(C.a.Control,{type:"text",name:"fullName",placeholder:"Enter full name",onBlur:i,value:n.fullName,onChange:o,isValid:a.fullName&&!t.fullName,isInvalid:a.fullName&&!!t.fullName}),r.a.createElement(C.a.Control.Feedback,{type:"invalid"},t.fullName)),r.a.createElement(C.a.Group,null,r.a.createElement(C.a.Label,null,"Email address"),r.a.createElement(C.a.Control,{type:"email",name:"email",placeholder:"Enter email",onBlur:i,value:n.email,onChange:o,isValid:a.email&&!t.email,isInvalid:a.email&&!!t.email}),r.a.createElement(C.a.Control.Feedback,{type:"invalid"},t.email)),r.a.createElement(C.a.Group,null,r.a.createElement(C.a.Label,null,"Password"),r.a.createElement(C.a.Control,{type:"password",name:"password",placeholder:"Password",onChange:o,onBlur:i,value:n.password,isValid:a.password&&!t.password,isInvalid:a.password&&!!t.password}),r.a.createElement(C.a.Control.Feedback,{type:"invalid"},t.password)),r.a.createElement(C.a.Group,null,r.a.createElement(C.a.Label,null,"Confirm Password"),r.a.createElement(C.a.Control,{type:"password",name:"confirmPassword",placeholder:"Password",onChange:o,onBlur:i,value:n.confirmPassword,isValid:a.confirmPassword&&!t.confirmPassword,isInvalid:a.confirmPassword&&!!t.confirmPassword}),r.a.createElement(C.a.Control.Feedback,{type:"invalid"},t.confirmPassword)),r.a.createElement(p.a,{variant:"primary",type:"submit",disabled:l},"Register"))}))},ge=function(){var e=Object(c.b)(),t=r.a.useCallback((function(t,n){return e(Object(re.d)(t)).catch((function(e){401===e.statusCode?n.setStatus("Incorrect email or password"):n.setStatus("Internal server error")}))}),[e]),n=r.a.useCallback((function(t,n){return e(Object(re.g)({fullName:t.fullName,email:t.email,password:t.password})).catch((function(e){409===e.statusCode?n.setStatus("The provided email address is already in use"):n.setStatus("Internal server error")}))}),[e]);return r.a.createElement(se.a,{transition:!1},r.a.createElement(de.a,{eventKey:"home",title:"Login"},r.a.createElement(be,{onSubmit:t})),r.a.createElement(de.a,{eventKey:"profile",title:"Register"},r.a.createElement(pe,{onSubmit:n})))},we=function(e){var t=e.show,n=void 0!==t&&t,a=e.onHide;return r.a.createElement("div",null,r.a.createElement(E.a,{show:n,onHide:a,animation:!1},r.a.createElement(E.a.Header,{closeButton:!0},r.a.createElement(E.a.Title,null,"Login")),r.a.createElement(E.a.Body,null,r.a.createElement(ge,null))))},he=function(){var e=Object(c.c)((function(e){return e.authModal})).isAuthModalVisible,t=Object(c.b)(),n=Object(a.useCallback)((function(){t(Object(le.b)())}),[t]);return r.a.createElement(we,{show:e,onHide:n})},Ee=n(68);t.default=function(){var e=Object(c.b)();return Object(a.useEffect)((function(){e(Object(re.b)()),e(Object(oe.c)()),e(Object(ie.b)()),e(Object(Ee.b)())}),[e]),r.a.createElement("div",{className:"container"},r.a.createElement(o.a,null,r.a.createElement(ue,null),r.a.createElement(he,null),r.a.createElement(i.c,null,r.a.createElement(i.a,{path:"/game/:id"},r.a.createElement(ae,null)),r.a.createElement(i.a,{path:"/"},r.a.createElement(N,null)))))}},234:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(24),i=n.n(o),c=n(9);n(185),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l,u=n(11),s=n(27),d=n(68),m=n(21),f=n(69),b=n(70),v=n(10),p=n(19),g=n(71),w=n(100),h=n(88),E=n(89),O=n(36),j=function(e,t){Object.assign(e.users,t.payload.entities.users),Object.assign(e.games,t.payload.entities.games)},k=Object(u.b)({name:"entities",initialState:{users:{},games:{}},reducers:{},extraReducers:(l={},Object(v.a)(l,m.c.type,(function(e,t){t.payload&&j(e,{type:t.type,payload:t.payload})})),Object(v.a)(l,m.e.type,j),Object(v.a)(l,m.h.type,j),Object(v.a)(l,d.c.type,j),Object(v.a)(l,p.k.type,j),Object(v.a)(l,p.b.type,j),Object(v.a)(l,p.o.type,j),Object(v.a)(l,p.m.type,j),Object(v.a)(l,p.d.type,j),Object(v.a)(l,p.f.type,j),Object(v.a)(l,g.b.type,j),Object(v.a)(l,h.b.type,j),Object(v.a)(l,h.a.type,j),Object(v.a)(l,E.b.type,(function(e,t){e.games[t.payload.gameId].turn="white"===e.games[t.payload.gameId].turn?"black":"white",e.games[t.payload.gameId].moves="".concat(e.games[t.payload.gameId].moves," ").concat(t.payload.move).trim()})),Object(v.a)(l,E.c.type,j),Object(v.a)(l,w.a.type,(function(e){Object.keys(e.games).forEach((function(t){var n=e.games[t];if("started"===n.status&&Object(O.a)(n).history().length>1){var a="white"===n.turn?"wtime":"btime";n[a]-=1e3,n[a]<0&&(n[a]=0),0===n[a]&&(n.status="outoftime",n.winner="white"===n.turn?"black":"white")}}))})),l)}).reducer,C=Object(s.c)({authModal:f.a,challengeAiModal:b.a,currentUser:m.a,gamesList:d.a,entities:k,singleGame:p.g});var y=Object(u.a)({reducer:C});!function(){var e=n(231).default;i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(c.a,{store:y},r.a.createElement(e,null))),document.getElementById("root"))}(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},36:function(e,t,n){"use strict";var a=n(163),r="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e.initialFen;"startpos"===n&&(n=r);var o=new a.Chess(n);return e.moves&&e.moves.split(" ").forEach((function(e,n){if(!(null!==t&&n>t)&&!o.move(e,{sloppy:!0}))throw Error("incorrect move: ".concat(e))})),o}},40:function(e,t,n){"use strict";var a=new(n(7).c.Entity)("users");t.a=a},48:function(e,t,n){e.exports={levelButtonGroup:"ChallengeAiForm_levelButtonGroup__1lnm_",colorSubmits:"ChallengeAiForm_colorSubmits__1pM28",colorSubmitsButton:"ChallengeAiForm_colorSubmitsButton__2P6Lx",whiteButton:"ChallengeAiForm_whiteButton__2nTjs",blackButton:"ChallengeAiForm_blackButton__1LVeL",randomButton:"ChallengeAiForm_randomButton__1S07l"}},68:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return m}));var a=n(11),r=n(7),o=n(16),i=n(13),c=Object(a.b)({name:"games",initialState:{isLoading:!0,error:null},reducers:{getGamesListRequest:function(e){e.isLoading=!0,e.error=null},getGamesListSuccess:function(e,t){e.isLoading=!1,e.error=null},getGamesListError:function(e,t){e.isLoading=!1,e.error=t.payload}}}),l=c.actions,u=l.getGamesListRequest,s=l.getGamesListSuccess,d=l.getGamesListError;t.a=c.reducer;var m=function(){return function(e){return e(u()),new Promise((function(t,n){o.a.socket.get("/game",(function(a,o){if(200===o.statusCode){var c=Object(r.b)(a,[i.a]);e(s(c)),t(a)}else e(d(a)),n(o)}))}))}}},69:function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return s}));var a,r=n(10),o=n(11),i=n(21),c=Object(o.b)({name:"authModal",initialState:{isAuthModalVisible:!1},reducers:{showAuthModal:function(e){e.isAuthModalVisible=!0},hideAuthModal:function(e){e.isAuthModalVisible=!1}},extraReducers:(a={},Object(r.a)(a,i.e.type,(function(e){e.isAuthModalVisible=!1})),Object(r.a)(a,i.h.type,(function(e){e.isAuthModalVisible=!1})),a)}),l=c.actions,u=l.showAuthModal,s=l.hideAuthModal;t.a=c.reducer},70:function(e,t,n){"use strict";n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return u}));var a=n(10),r=n(11),o=n(71),i=Object(r.b)({name:"challengeAiModal",initialState:{isChallengeAiModalVisible:!1},reducers:{showChallengeAiModal:function(e){e.isChallengeAiModalVisible=!0},hideChallengeAiModal:function(e){e.isChallengeAiModalVisible=!1}},extraReducers:Object(a.a)({},o.b.type,(function(e){e.isChallengeAiModalVisible=!1}))}),c=i.actions,l=c.showChallengeAiModal,u=c.hideChallengeAiModal;t.a=i.reducer},71:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return m}));var a=n(11),r=n(7),o=n(16),i=n(13),c=Object(a.b)({name:"challenge",initialState:{},reducers:{challengeAiRequest:function(){},challengeAiSuccess:function(e,t){},challengeAiError:function(e,t){}},extraReducers:{}}),l=c.actions,u=l.challengeAiRequest,s=l.challengeAiSuccess,d=l.challengeAiError,m=(c.reducer,function(e){return function(t){return t(u()),new Promise((function(n,a){o.a.socket.post("/api/v1/challenge/ai",e,(function(e,o){if(200===o.statusCode){var c=Object(r.b)(e,i.a);t(s(c)),n(e)}else t(d(e)),a(o)}))}))}})},88:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return d})),n.d(t,"c",(function(){return m}));var a=n(162),r=n(11),o=n(7),i=n(16),c=n(13),l=Object(r.b)({name:"dataSubscription",initialState:{},reducers:{updateGameBySubscription:function(e,t){},createGameBySubscription:function(e,t){}},extraReducers:{}}),u=l.actions,s=u.updateGameBySubscription,d=u.createGameBySubscription,m=(l.reducer,function(){return function(e){i.a.socket.on("game",(function(t){if("updated"===t.verb){var n=Object(a.a)({},t.previous,{},t.data),r=Object(o.b)(n,c.a);e(s(r))}else if("created"===t.verb){var i=Object(o.b)(t.data,c.a);e(d(i))}}))}})},89:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return m}));var a=n(11),r=n(7),o=n(16),i=n(13),c=Object(a.b)({name:"move",initialState:{},reducers:{makeMoveRequest:function(e,t){},makeMoveSuccess:function(e,t){},makeMoveError:function(e,t){}},extraReducers:{}}),l=c.actions,u=l.makeMoveRequest,s=l.makeMoveSuccess,d=l.makeMoveError,m=(c.reducer,function(e,t){return function(n){return n(u({gameId:e,move:t})),new Promise((function(a,c){o.a.socket.post("/api/v1/board/game/".concat(e,"/move/").concat(t),{},(function(e,t){if(200===t.statusCode){var o=Object(r.b)(e,i.a);n(s(o)),a(e)}else n(d(e)),c(t)}))}))}})}},[[177,1,2]]]);
//# sourceMappingURL=main.407e0973.chunk.js.map